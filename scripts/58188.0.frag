#ifdef GL_ES
precision mediump float;
#endif

uniform float time;
uniform vec2 resolution;

mat4 mix(mat4 u,mat4 v, float t) { return v*t+u*(1.-t); }   // comment this line out if error or mix is already implemented for mat4

// custom font , Xavierseb 2019
#define _ mat4( vec4(-1.4,-1.4,1.4,1.4), vec4(-1.), vec4(0.), vec4(-1.))
#define UP mat4( vec4(0.), vec4(10.), vec4(0.), vec4(10.))
#define A mat4( .75,-1.32,-1.44,.75,.77,1.95,-2.28,-.59,.75,1.05,.32,1.,-.59,1.82,.78,-1. )
#define B mat4( -1.,.3,-1.66,-.8, .2,3.3,5.,-1., -1.,.6,2.,-.8, .2,2.6,-1.6,-1.)
#define C mat4( .8,-.5,-2.1,.94, .8,1.8,-1.8,-.8, .7,-.5,-2.1,.94, .8,1.8,-1.8,-.8)
#define D mat4( .64,-.8,-1.8,.74, .78,1.9,-1.7,-.86, .74,1.3,-.63,1., -.43,4.8,3.8,0.)
#define E mat4( -.8,2.8,-.65,-.8, 0.,-.27,2.3,-.1, -.8,-.82,-.92,1., -.1,-.32,-1.2,-1.)
#define F mat4( -.44,2.1,-1.,0., .44,4.4,4.,-3.2, 0.,.6,-1.3,.62, -3.2,1.3,.56,.6)
#define G mat4( .9,-.4,-2.3,.84, .34,2.4,-1.8,-.99, .9,1.,-1.,-.9, 0.,-4.7,-3.5,-2.9)
#define H mat4( -1.,.9,-1.1,-.75, .43,4.5,3.4,-.5, -.75,-.24,.78,.94, -1.,3.7,-1.35,-1.)
#define I mat4( 0.,-.14,-1.19,.64, .8,-.48,-1.07,-1., -.05,.43,-.34,.07, 2.88,2.71,2.67,2.86)
#define J mat4( 0.,-.3,-1.,-.8, .5,-5.19,-1.7,-2.5, -.05,.43,-.34,.03, 2.88,2.71,2.67,2.96)
#define K mat4( -.94,.58,-1.1,-.94, .6,4.35,3.6,-.7, .4,-2.4,.3,.8, .8,0.,0.,-1.)
#define L mat4( -.4,1.,.3,-.17, -.95,1.2,3.8,2.8, -.17,-.8,.38,.84, 2.8,1.8,-1.,-.95)
#define M mat4( -.9,-.9,-.33,0., -1.,1.6,1.6,-.7, 0.,.33,.9,.9, -.7,1.6,1.6,-1.)
#define N mat4( -1.07,-.64,-.9,-.76, .35,.93,.85,-1., -.75,-.9,.7,.94, -1.,.85,1.9,-1.)
#define O mat4( 0.,-1.1,-1.1,0., 1.,.82,-.8,-1., 0.,1.1,1.1,0., -1.,-.8,.82,1.)
#define P mat4( -1,-.43,-.58,-.73, .43,1.5,-1.9,-3., -.7,.83,1.75,-.7, .8,1.9,-1.75,-.8)
#define Q mat4( .7,-.83,-1.75,0., .8,1.9,-1.75,-.8, .7,-.5,-.54,.93, .26,-2.7,-4.76,-2.5)
#define R mat4( -.88,-.28,-.43,-.5, .86,1.5,-.67,-1., -.5,-.54,.22,.9, -1.,1.,1.,.8)
#define S mat4( .78,-.7,-1.5,0., .88,1.34,.55,0., 0.,1.5,.67,-.9, 0.,-.55,-1.35,-.8)
#define T mat4( -.55,.35,-1.37,.76, 3.,1.16,-1.1,-1., -1.,-.7,-1.4,.9, 1.64,1.54,1.7,1.7)
#define U mat4( -.9,-1.1,1.,.72, .9,-1.6,-1.7,.9, .72,.7,1.,1.4, .9,-1.6,-1.,-.77)
#define V mat4( -1.,-.83,-.236,0., .88,1.5,-.73,-1., 0.,1.55,-.25,1., -1.,1.8,.9,.65)
#define W mat4( -.9,-1.2,-.33,0., .9,-1.6,-1.6,.7, 0.,.33,.9,.9, .7,-1.6,-1.6,.9)
#define X mat4( .83,.25,-.3,-1., .95,.6,-.5,-1., -.9,.48,-.43,1., .87,.35,-.5,-1.)
#define Y mat4( -.9,-.2,.9,.9, .9,-2.9,0.,.9, .9,-.37,-1.,-.9, .2,-4.7,-3.5,-2.9)
#define Z mat4( -.9,1.1,1.3,0., .9,.9,1.5,0., 0.,-1.3,-1.1,.9, 0.,-1.5,-.9,-.9)
#define LV mat4( 0.,-.45,-2.,0., .58,1.4,1.,-1., 0.,2.,.45,0., -1.,1.,1.4,.58)
#define QU mat4( -.66,2.7,-.3,-.05, 2.9,3.3,1.6,.58, -.05,.43,-.34,.03, -.42,-.59,-.63,-.44)

#define gettext(x0,u0,v0) min(c,distance(getPos(t,u0/20.,v0/10.),position-vec2(x0-.05,0.)))
#define a2z(xt,y,u) else if(position.x<xt+y && position.x>xt-.25) for(float t=0.;t<1.;t+=.01) c=min(c,min(gettext(xt,u[0],u[1]),gettext(xt,u[2],u[3])));

vec2 getPos(in float t, in vec4 x, in vec4 y)
{
    float t1 = 1.-t; 
    vec4 n = vec4(t1*t1*t1, 3.*t1*t1*t, 3.*t1*t*t, t*t*t);    
    return vec2(dot(x,n), dot(y,n));
}
	
#define  T1 mod(time,8.)
#define  mx( u, v, t)  mix(u,v,clamp(t,0.,1.))
void main( void ){;
	vec2 position = gl_FragCoord.xy/resolution.xy -vec2(.5, .5+sin(time*2.+(gl_FragCoord.xy/resolution.xy).x*4.)/15.);
	float c=10., x=-.4;
		
	//mat4 rot4=mat4(cos(F1),sin(F1),0.,0.,-sin(F1),cos(F1),0.,0.,0.,0.,cos(F1),sin(F1),0.,0.,-sin(F1),cos(F1));
	float loop = (mod(1.-max(sin(time*2.),0.),1.01));
	float ti = (1.2+pow(sin(time*4.),8.)/8.);
	if(false); // left of char
		// a2z ( x-position, offset (draw 1, 2 or more times depending on extents), char data )
		//a2z(x+.030,-.04,_) 
		a2z(x+.155,-.05,mx(D,mx(I,mx(B,H,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.260,-.04,mx(O,mx(T,mx(A,A,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.370,-.05,mx(E,mx(_,mx(N,R,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.485,-.05,mx(S,mx(_,mx(G,D,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.870,-.06,_) 
	if(false); // right of char
		a2z(x+.030,.067,_) 
		a2z(x+.155,.06,mx(D,mx(I,mx(B,L,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.260,.06,mx(O,mx(T,mx(A,O,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.370,.06,mx(E,mx(_,mx(N,U,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.485,.06,mx(S,mx(_,mx(G,D,T1-7.),T1-3.),T1-1.)) 
		a2z(x+.730,.08,mx(_,mx(QU*ti,UP,T1-4.5),T1-1.)) 
		a2z(x+.870,.09,_) 
			
	float mc=1.-1.47*sin(smoothstep(c*c+.00455,.0,.002));
	
	gl_FragColor = 
		mx( 
		vec4( 6.*vec3(2.848,.89,2.999)*mc, 1.0 ),	
		mx(
		vec4( 6.*vec3(.848*mc+0.975*(1.-1.47*sin(smoothstep(c*c*c*8.+.005455,.0,.002))),
										0.025*mc,
										0.975*(1.-1.47*sin(smoothstep(c*c*14.+.00455,.0,.002)))), 1.0 ),
		mx(
		vec4( 6.*vec3(4.848*mc,0.975*mc,0.975*(1.-1.47*sin(smoothstep(c*c*c*4.+.00455,.0,.002)))), 1.0 ),
		vec4( 6.*vec3(2.848,.89,2.999)*mc, 1.0 ),	
		T1-4.),
		T1-3.),
		T1-1.);	
}